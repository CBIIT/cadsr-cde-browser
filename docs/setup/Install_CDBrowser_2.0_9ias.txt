=============================================================================
CDE Browser 2.0 Installation Document for Oracle 9ias
=============================================================================

Pre-requisites
---------------

1. 9ias 9022 or above installed. Available from http://otn.oracle.com
2. caDSR repository installed. Please refer to caDsr installation document

Installation steps
------------------

Please replace the following references with your environment specific information.

<ORACLE_HOME> refers to 9ias home directory.
<INSTALL_HOME> refers to directory to which "CDBrowser_2.0.zip" is unzipped.
OC4J_INSTANCE refers to oc4j instance on which CDEBrowser is to be deployed.
<DB_HOST> referes to fully qualified name or IP address of the caDSR repository.
		database   host . eg. test.nih.nci.com
<DB_PORT> referes to the database port eg 1521
<DB_SID>  referes to caDSR repository SID
<SCHEMA_PASSWORD1> referes to caDSR repository password for 
                                                  database user SBR_CBTESTDS
<SCHEMA_PASSWORD2> referes to caDSR repository password for
		              database user  SBREXT_CBTESTDS


1. Setup the datasources in 9ias by adding the following snippet to 
	<ORACLE_HOME>\j2ee\<OC4J_INSTANCE>config\datasources.xml	

	The following must be added within tag <data-sources>
	
       <data-source class="com.evermind.sql.DriverManagerDataSource" 
       		connection-driver="oracle.jdbc.driver.OracleDriver" 
       		ejb-location="jdbc/SBR_CoreDS" inactivity-timeout="30" 
       		location="jdbc/SBR_CoreDS" name="SBR_CBTESTDS" 
       		password=<SCHEMA_PASSWORD1> pooled-location="jdbc/SBR_CoreDS" 
       		url="jdbc:oracle:thin:@<DB_HOST>:<DB_PORT>:<DB_SID>" 
       		username="SBR" xa-location="jdbc/xa/SBR_CoreDS"/>
       		
       <data-source class="com.evermind.sql.DriverManagerDataSource" 
       		connection-driver="oracle.jdbc.driver.OracleDriver" 
       		ejb-location="jdbc/SBREXT_CoreDS" inactivity-timeout="30" 
       		location="jdbc/SBREXT_CBTESTCoreDS" name="SBREXT_CoreDS" 
       		password=<SCHEMA_PASSWORD2> pooled-location="jdbc/SBREXT_CoreDS" 
       		url="jdbc:oracle:thin:@<DB_HOST>:<DB_PORT>:<DB_SID>" 
       		username="sbrext" xa-location="jdbc/xa/SBREXT_CoreDS"/>
       
       eg.
       
       <?xml version = '1.0' encoding = 'windows-1252'?>
       <!DOCTYPE data-sources PUBLIC "Orion data-sources" 
       		"http://xmlns.oracle.com/ias/dtds/data-sources.dtd">

         <data-sources>
         .
         .
         .
            <data-source class="com.evermind.sql.DriverManagerDataSource" 
        	connection-driver="oracle.jdbc.driver.OracleDriver" 
        	ejb-location="jdbc/SBR_CoreDS" inactivity-timeout="30" 
        	location="jdbc/SBR_CoreDS" name="SBR_CoreDS" 
        	password="sbr_paswd" pooled-location="jdbc/SBR_CoreDS" 
        	url="jdbc:oracle:thin:@cbiodb2-d.nci.nih.gov:1521:cbtest" 
        	username="SBR" xa-location="jdbc/xa/SBR_CoreDS"/>
        	
            <data-source class="com.evermind.sql.DriverManagerDataSource" 
        	connection-driver="oracle.jdbc.driver.OracleDriver" 
        	ejb-location="jdbc/SBREXT_CoreDS" inactivity-timeout="30" 
        	location="jdbc/SBREXT_CoreDS" name="SBREXT_CoreDS" 
        	password="sbrext_paswd" pooled-location="jdbc/SBREXT_CoreDS" 
        	url="jdbc:oracle:thin:@cbiodb2-d.nci.nih.gov:1521:cbtest" 
        	username="sbrext" xa-location="jdbc/xa/SBREXT_CoreDS"/>
  	 .
  	 .
         </data-sources>
2.  Update the Oracle9iAS with the configuration file changes.
	
	<ORACLE_HOME>\dcm\dcmctl updateConfig -ct oc4j -co <OC4J_INSTANCE> -v
         
3.  Deploy CDEBrowser.ear using DCMCTL(To deploy using Enterprise Manager refer
	to section 'Steps to deploy cdebrowser.ear Using Enterprise Manager')

  3.1  Start dcmtl in shell mode i.e.

    	<ORACLE_HOME>\dcm\dcmctl shell

    	Once started you will get the dcmctl> prompt

  3.2  To deploy the application enter the following:

     deployApplication -f <INSTALL_HOME>\cdebrowser.ear 
      		-a CDEBrowser -rc /CDEBrowser -co <OC4J_INSTANCE> -v



  3.3  If dcmctl comes back with deployment successful, then you 
  	are good to go. If dcmctl comes back with a message that it is 
  	executing asynchronously,then the deployment is still in process
  	in the background.  To check the status, you will need to use

    	dcmctl getReturnStatus -v

    	Only after you get a deployment successful, then only it is done.

  3.4  After deployment is successful, exit form dcmctl

4. <ORACLE_HOME>\j2ee\<OC4J_INSTANCE>\applications\CDEBrowser\CDEBrowser
    \WEB-INF\classes\cle_providers.xml contains the connection information 
    for SBR repository schemaupdate this file to reflect your connection parameters.
   
   eg.
   <?xml version="1.0"?>
   <!DOCTYPE cle-providers SYSTEM "http://xmlns.oracle.com/ias/mvc/cle-providers.dtd">
   <cle-providers>
     <provider name="cdebrowser_bc4j" 
     		class="oracle.clex.persistence.bc4j.ApplicationModuleProvider">
       <property name="user" value="sbr"/>
       <property name="password" value="sbr_paswd"/>
       <property name="modulename" 
       		value="gov.nih.nci.ncicb.cadsr.persistence.bc4j.CDEBrowserBc4jModule"/>
       <property name="connectionstring" 
       		value="jdbc:oracle:thin:sbr/sbr_paswd@cbiodb2-d.nci.nih.gov:1521:cb"/>
       <property name="host" value="cbiodb2-d.nci.nih.gov"/>
       <property name="sid" value="cb"/>
       <property name="persistencebase" 
       		value="gov.nih.nci.ncicb.cadsr.persistence.bc4j"/>
       <property name="failover" value=""/>
     </provider>
    </cle-providers>

5. <ORACLE_HOME>\j2ee\<OC4J_INSTANCE>\applications\CDEBrowser
     \CDEBrowser\WEB-INF\classes\cdebrowser.properties contains the entry 
     'XML_DOWNLOAD_DIR' that points to the default directory in which xml
     and excel files are created temporarily before the user  downloads 
     the files.
   
   Edit this entry to point a directory on the server.
   NOTE: '\\' must be used for separators 
   eg.
   	XML_DOWNLOAD_DIR=c:\\temp\\download\\xml\\
   	
6. Access the application using url http://<HOST>:<POST>/CDEBrowser/
    eg.
    	http://localhost:7777/CDEBrowser/


-------------------------------------------------------------------------
Steps to deploy cdebrowser.ear Using Enterprise Manager
-------------------------------------------------------------------------
1.  Go to the enterprise manager i.e. http://<HOST>:1810

2.  Login as ias_admin/oracle9ias

3.  Click on the 9ias middle tier instance 

4.  Click on <OC4J_INSTANCE>

5.  Click on Deploy EAR file

6.  Skip the intro screen and go to Step 2.

7.  Select the smart.ear file to deploy, and the application name is smart

8.  On Step 3, the root-context is /CDEBrowser.  

9.  Skip Step 4 and go to Step 5.  

10. Click on Finish, and start the deployment.  It will take a few minutes.
